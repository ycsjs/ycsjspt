<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>尤物后台管理系统-管理员权限管理</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="../../../../statics/resource/common/plugs/metronic/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="../../../../statics/resource/common/plugs/metronic/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/bootstrap-fileupload.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/chosen.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/select2_metro.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/jquery.tagsinput.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/clockface.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/bootstrap-wysihtml5.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/datepicker.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/timepicker.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/colorpicker.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/bootstrap-toggle-buttons.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/daterangepicker.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/datetimepicker.css" />
    <link rel="stylesheet" type="text/css" href="../../../../statics/resource/common/plugs/metronic/css/multi-select-metro.css" />
    <link href="../../../../statics/resource/common/plugs/metronic/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>
    <!-- END PAGE LEVEL STYLES -->
    <link rel="shortcut icon" href="../../../../statics/resource/common/plugs/metronic/image/favicon.ico" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed" style="background-color:#FFFFFF !important">

<!-- BEGIN SAMPLE FORM PORTLET-->
<div class="portlet box blue margin-top-10">
<div class="portlet-title">
    <div class="caption"><i class="icon-reorder"></i>管理员权限管理</div>
    <div class="tools">
        <a href="javascript:;" class="collapse"></a>
    </div>
</div>
<div class="portlet-body form">
<!-- BEGIN FORM-->

    {{foreach from=$all_menu item=val key=key name=foo}}
        <div class="alert alert-success">
            <label class="control-label"><strong style="font-size: 18px;">{{$val['menu_name']}}</strong> &nbsp;<input type="checkbox" value="" class="yes_menu_all" select_all="false"/>全选</label>
            {{foreach from=$val['menu_list'] item=va key=ke name=fo}}
                <div class="alert alert-info">
                    <label class="control-label"><strong style="font-size: 14px;">{{$va['menu_name']}}</strong> &nbsp;<input type="checkbox" value="" class="yes_menu_all" select_all="false"/>全选</label>
                    <div class="controls">
                        {{foreach from=$va['menu_list'] item=v key=k name=f}}
                            <label class="checkbox alert" restrict_menu={{$key}}_{{$ke}}_{{$k}} >
                                <input type="checkbox" class='restrict' value=""
                                {{if ($account_restrict[$key][$ke][$k]==1)}}
                                has_restrict='true'
                                {{else}}
                                has_restrict='false'
                                {{/if}}
                                />
                                {{$v['menu_name']}}
                            </label>
                        {{/foreach}}
                    </div>
                </div>
            {{/foreach}}
        </div>
    {{/foreach}}




<div class="form-actions text-center">
    <input type="hidden" id="account_id" value="{{$account_info.ID}}"/>
    <input type="hidden" id="app_http_url" value="{{$app_http_url}}"/>
    <button type="submit" id="save_restrict" class="btn blue">保存</button>
    <a href="{{$app_http_url}}Account/ListAccount"><button type="button" id="cancel_restrict" class="btn">返回</button></a>
</div>

<!-- END FORM-->
</div>
</div>
<!-- END SAMPLE FORM PORTLET-->

<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="../../../../statics/resource/common/plugs/metronic/js/excanvas.min.js"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/respond.min.js"></script>
<![endif]-->
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery.blockui.min.js" type="text/javascript"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery.cookie.min.js" type="text/javascript"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/jquery.uniform.min.js" type="text/javascript" ></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/ckeditor.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-fileupload.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/chosen.jquery.min.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/select2.min.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/wysihtml5-0.3.0.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-wysihtml5.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/jquery.tagsinput.min.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/jquery.toggle.buttons.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/clockface.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/date.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/daterangepicker.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-timepicker.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/jquery.inputmask.bundle.min.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/jquery.input-ip-address-control-1.0.min.js"></script>
<script type="text/javascript" src="../../../../statics/resource/common/plugs/metronic/js/jquery.multi-select.js"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-modal.js" type="text/javascript" ></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/bootstrap-modalmanager.js" type="text/javascript" ></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="../../../../statics/resource/common/plugs/metronic/js/app.js"></script>
<script src="../../../../statics/resource/common/plugs/metronic/js/form-components.js"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>

    $(document).ready(function () {
        App.init();
        FormComponents.init();

        //初始化打钩有权限的菜单项
        $(".restrict").each(function () {
            if ($(this).attr("has_restrict") == "true") {
                $(this).parent("span").addClass("checked");
            }
        });

        //逐个点击菜单项
        $(".restrict").click(function () {
            if ($(this).attr("has_restrict") == "true") {
                $(this).parent("span").removeClass("checked");
                $(this).attr("has_restrict", "false");
            } else {
                $(this).parent("span").addClass("checked");
                $(this).attr("has_restrict", "true");
            }
        });

        //全选按钮点击
        $(".yes_menu_all").click(function () {
            if (!($(this).attr("select_all") == "false")) {
                $(this).parent().parent().parent().parent().find(".yes_menu_all").parent("span").removeClass("checked");
                $(this).parent().parent().parent().parent().find(".restrict").parent("span").removeClass("checked");
                $(this).parent().parent().parent().parent().find(".restrict").attr("has_restrict",false);
                $(this).attr("select_all", "false");
            } else {
                $(this).parent().parent().parent().parent().find(".yes_menu_all").parent("span").addClass("checked");
                $(this).parent().parent().parent().parent().find(".restrict").parent("span").addClass("checked");
                $(this).parent().parent().parent().parent().find(".restrict").attr("has_restrict",true);
                $(this).attr("select_all", "true");
            }
        });

        //保存权限
        $("#save_restrict").click(function () {
            var restrict = [];
            $(".restrict").each(function () {
                if ($(this).attr("has_restrict") == "true") {
                    var restrict_menu = $(this).parent().parent().parent().attr("restrict_menu");
                    restrict.push(restrict_menu);
                }
            });
            var app_http_url = $("#app_http_url").val();
            var restrict_str = restrict.join(":");
            var account_id = $.trim($("#account_id").val());
            if (account_id !== '' && restrict_str !== '') {
                $.ajax({
                    type: "get",
                    url: app_http_url + "Account/AjaxSaveRestrictAccount",
                    dataType: "json",
                    data: {restrict_str: restrict_str, account_id: account_id},
                    success: function (data) {
                        if (data) {
                            alert("修改成功!");
                        }
                    }
                });
            }
        });
    });
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>